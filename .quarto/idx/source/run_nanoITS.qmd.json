{"title":"Run NanoITS","markdown":{"yaml":{"title":"Run NanoITS","execute":{"eval":false},"engine":"knitr"},"headingText":"Modify the configuration file","containsRefs":false,"markdown":"\n\n\nNanoITS will take de-multiplexed and compressed fastq files as input and generate OTU tables and some several summary statistics as output. Please, provide a single fastq.gz file per sample.\n\n\nTo run NanoITS you need to provide some information in the configuartion file. In the NanoITs configuration file, also called config.yaml, you can provide the sample name, sample path and modify some parameters for the different software used. \n\nTo change the default settings and tell Snakemake where your data is located copy the `config/config.yaml` file found in the NanoITs folder to the folder in which you want to analyse your data, i.e. like this:\n\n```{bash}\ncp <path_to NanoITS_folder>/config/config.yaml .\n```\n\nYou can of course run your analyses in NanoITS folder you downloaded, but often its easier to separate software from analyses.\n\nNext, open the config.yaml with an editor, such as nano. There are several things you can modify:\n\n**The project name**\n\nYou can provide the project name in `project: \"run_v1\"`. Your results will be generated in the folder you start the snakemake workflow in and the results will be generated in `results/<project_name>` (`results/run_v1` if you use the default settings). Your project name can contain letters, numbers, `_` and `-`. Do not use other symbols, such as spaces or dots.\n\n**The mapping file**\n\nHere, you need to provide the path to a comma-separated mapping file that describes the samples you want to analyse, i.e. `samples_file: \"input/mapping.csv\"`. This file needs to contain the following columns:\n\n1. `sample`: The names of your sample. This id will be used to label all files created in subsequent steps. Your sample names should be unique and only contain letters, numbers and `-`. Do not use other symbols, such as spaces, dots or underscores in your sample names.\n2. `barcode`: The barcode ID. Can be empty as it is not actively used in the workflow as of now\n3. `path`: Path to the fastq.gz files. You can provide the relative path (i.e. relative to the working directory you start the snakemake workflow in) or absolute path (i.e. the location of a file or directory from the root directory(`/`)). The workflow accepts one file per barcode, so if you have more than one file merge these files first, for example using the `cat` command.\n\nExample mapping file:\n\n```\nsample,barcode,path\nbc01,barcode01,/path/barcode01.fastq.gz\nbc02,barcode02,/path/barcode02.fastq.gz\n...\n```\n\n**The classifiers to use**\n\nYou can choose what classifiers you want to use in `classifiers: [\"minimap2\", \"kraken2\"]`. Currently, two classifiers are implemented: (a) the alignment-based classifier minimap2 and (b) the kmer-based classifier kraken2. You can use both or either of the two classifiers.\n\n**The markers to investigate**\n\nYou can select what markers you want to analyse in `markers: [\"SSU\", \"ITS1\"]`. The workflow was developed for primers targetting both the SSU and ITS1 but the workflow will also run for either option selected and we plan to in the future extend the workflow to also accept the LSU rRNA gene.\n\n**Other parameters**\n\nFinally, you can change tool specific parameters: If desired, there are several parameters that can be changed by the user, such as the numbers of threads to use, the settings for the read filtering or the classification and so on. The configuration file provides more information on each parameter.\n\nSince several steps of this workflow are quite resource intensive, we recommend running this worklow on an HPC and set the numbers of threads used by each process accordingly.\n\n\n\n## Run NanoITS\n\n### Dry-run\n\nTo test whether the workflow is defined properly do a dry-run first. To do this, change part of the snakemake command as follows:\n\n1. Provide the path to where you installed NanoITS afer `--s`\n2. Provide the path to the edited config file after `--configfile`\n3. Provide the path to where you want snakemake to install all program dependencies after `--conda-prefix`. We recommend to install these into the folder in which you downloaded NanoITS but you can change this if desired\n\n```{bash}\n#activate conda environment with your snakemake installation, i.e. \nmamba activate snakemake_7.32.4\n\n#test if everything runs as extended (edit as described above)\nsnakemake --use-conda --cores 1 \\\n  -s <path_to_NanoITS_install>/workflow/Snakefile \\\n  --configfile config/config.yaml \\\n  --conda-prefix <path_to_NanoITS_install>/workflow/.snakemake/conda  \\\n  --rerun-incomplete --nolock -np \n```\n\n\n### Run NanoITS interactively\n\nIf the dry-run was successful you can run snakemake interactively with the following command. Adjust the cores according to your system.\n\n```{bash}\nsnakemake --use-conda --cores 1 \\\n  -s <path_to_NanoITS_install>/workflow/Snakefile \\\n  --configfile config/config.yaml \\\n  --conda-prefix <path_to_NanoITS_install>/workflow/.snakemake/conda \\\n  --rerun-incomplete --nolock\n```\n\n\n### Run NanoITS on Crunchomics (Uva-specific option)\n\nOr via a slurm HPC, such as UvA´s crunchomics server by doing the following edits in jobscript.sh:\n\n1. Exchange the line that utilizes snakemake with the line of code that you used for the dry-run to ensure that all paths are set correctly.\n2. Adjust the number of CPUs as needed\n\n```{bash}\nsbatch jobscript.sh\n```\n\n\n\n## Generate a report\n\nAfter a successful run, you can create a report with some of the key output files as follows:\n\n```{bash}\nsnakemake --report report.html \\\n  --configfile config/config.yaml \\\n  -s <path_to_NanoITS_install>/workflow/Snakefile\n```\n\nAt the moment the report contains:\n\n- A shematic of the steps executed\n- Information about the reads before and after quality filtering (one file for each sample)\n- Information about the number of SSU and ITS1 sequences extracted before and after quality filtering\n- The results from the different classifiers represented as barplots (total counts and relative abundance) for different taxonomic ranks\n- Statistics of the snakemake run\n\nAdditionally, you can find some OTU tables in these locations:\n\n- `results/<project_name>/tables/{marker}_otu_table.txt`: An OTU table based on the taxonomy assignment and including the counts for each sample and classifier. The table is generated once for each marker generated.\n- `results/<project_name>/tables/{marker}_otu_table_filtered..txt`: A filtered OTU table based on the taxonomy assignment and including the counts for each sample and classifier. The table is generated once for each marker generated. The filtering discards samples with =<20 reads and singletons and the barplots in the reports where generated from the filtered OTU table.\n- `results/<project_name>/classification/{classifier}/{marker}.merged.outmat.tsv`: An OTU table based on the taxonomy assignment and including the counts for each sample. One separate table is generated for each marker investigated and classifier used. \n\n\n### Generate a report with the old report format\n\nSnakemake v7.32.4 generates reports in a new format, which is a bit more convoluted than the older format. If you prefer the old format, you can create if running snakemake --report with an older version, such as snakemake v6.8.0.","srcMarkdownNoYaml":"\n\n\nNanoITS will take de-multiplexed and compressed fastq files as input and generate OTU tables and some several summary statistics as output. Please, provide a single fastq.gz file per sample.\n\n## Modify the configuration file\n\nTo run NanoITS you need to provide some information in the configuartion file. In the NanoITs configuration file, also called config.yaml, you can provide the sample name, sample path and modify some parameters for the different software used. \n\nTo change the default settings and tell Snakemake where your data is located copy the `config/config.yaml` file found in the NanoITs folder to the folder in which you want to analyse your data, i.e. like this:\n\n```{bash}\ncp <path_to NanoITS_folder>/config/config.yaml .\n```\n\nYou can of course run your analyses in NanoITS folder you downloaded, but often its easier to separate software from analyses.\n\nNext, open the config.yaml with an editor, such as nano. There are several things you can modify:\n\n**The project name**\n\nYou can provide the project name in `project: \"run_v1\"`. Your results will be generated in the folder you start the snakemake workflow in and the results will be generated in `results/<project_name>` (`results/run_v1` if you use the default settings). Your project name can contain letters, numbers, `_` and `-`. Do not use other symbols, such as spaces or dots.\n\n**The mapping file**\n\nHere, you need to provide the path to a comma-separated mapping file that describes the samples you want to analyse, i.e. `samples_file: \"input/mapping.csv\"`. This file needs to contain the following columns:\n\n1. `sample`: The names of your sample. This id will be used to label all files created in subsequent steps. Your sample names should be unique and only contain letters, numbers and `-`. Do not use other symbols, such as spaces, dots or underscores in your sample names.\n2. `barcode`: The barcode ID. Can be empty as it is not actively used in the workflow as of now\n3. `path`: Path to the fastq.gz files. You can provide the relative path (i.e. relative to the working directory you start the snakemake workflow in) or absolute path (i.e. the location of a file or directory from the root directory(`/`)). The workflow accepts one file per barcode, so if you have more than one file merge these files first, for example using the `cat` command.\n\nExample mapping file:\n\n```\nsample,barcode,path\nbc01,barcode01,/path/barcode01.fastq.gz\nbc02,barcode02,/path/barcode02.fastq.gz\n...\n```\n\n**The classifiers to use**\n\nYou can choose what classifiers you want to use in `classifiers: [\"minimap2\", \"kraken2\"]`. Currently, two classifiers are implemented: (a) the alignment-based classifier minimap2 and (b) the kmer-based classifier kraken2. You can use both or either of the two classifiers.\n\n**The markers to investigate**\n\nYou can select what markers you want to analyse in `markers: [\"SSU\", \"ITS1\"]`. The workflow was developed for primers targetting both the SSU and ITS1 but the workflow will also run for either option selected and we plan to in the future extend the workflow to also accept the LSU rRNA gene.\n\n**Other parameters**\n\nFinally, you can change tool specific parameters: If desired, there are several parameters that can be changed by the user, such as the numbers of threads to use, the settings for the read filtering or the classification and so on. The configuration file provides more information on each parameter.\n\nSince several steps of this workflow are quite resource intensive, we recommend running this worklow on an HPC and set the numbers of threads used by each process accordingly.\n\n\n\n## Run NanoITS\n\n### Dry-run\n\nTo test whether the workflow is defined properly do a dry-run first. To do this, change part of the snakemake command as follows:\n\n1. Provide the path to where you installed NanoITS afer `--s`\n2. Provide the path to the edited config file after `--configfile`\n3. Provide the path to where you want snakemake to install all program dependencies after `--conda-prefix`. We recommend to install these into the folder in which you downloaded NanoITS but you can change this if desired\n\n```{bash}\n#activate conda environment with your snakemake installation, i.e. \nmamba activate snakemake_7.32.4\n\n#test if everything runs as extended (edit as described above)\nsnakemake --use-conda --cores 1 \\\n  -s <path_to_NanoITS_install>/workflow/Snakefile \\\n  --configfile config/config.yaml \\\n  --conda-prefix <path_to_NanoITS_install>/workflow/.snakemake/conda  \\\n  --rerun-incomplete --nolock -np \n```\n\n\n### Run NanoITS interactively\n\nIf the dry-run was successful you can run snakemake interactively with the following command. Adjust the cores according to your system.\n\n```{bash}\nsnakemake --use-conda --cores 1 \\\n  -s <path_to_NanoITS_install>/workflow/Snakefile \\\n  --configfile config/config.yaml \\\n  --conda-prefix <path_to_NanoITS_install>/workflow/.snakemake/conda \\\n  --rerun-incomplete --nolock\n```\n\n\n### Run NanoITS on Crunchomics (Uva-specific option)\n\nOr via a slurm HPC, such as UvA´s crunchomics server by doing the following edits in jobscript.sh:\n\n1. Exchange the line that utilizes snakemake with the line of code that you used for the dry-run to ensure that all paths are set correctly.\n2. Adjust the number of CPUs as needed\n\n```{bash}\nsbatch jobscript.sh\n```\n\n\n\n## Generate a report\n\nAfter a successful run, you can create a report with some of the key output files as follows:\n\n```{bash}\nsnakemake --report report.html \\\n  --configfile config/config.yaml \\\n  -s <path_to_NanoITS_install>/workflow/Snakefile\n```\n\nAt the moment the report contains:\n\n- A shematic of the steps executed\n- Information about the reads before and after quality filtering (one file for each sample)\n- Information about the number of SSU and ITS1 sequences extracted before and after quality filtering\n- The results from the different classifiers represented as barplots (total counts and relative abundance) for different taxonomic ranks\n- Statistics of the snakemake run\n\nAdditionally, you can find some OTU tables in these locations:\n\n- `results/<project_name>/tables/{marker}_otu_table.txt`: An OTU table based on the taxonomy assignment and including the counts for each sample and classifier. The table is generated once for each marker generated.\n- `results/<project_name>/tables/{marker}_otu_table_filtered..txt`: A filtered OTU table based on the taxonomy assignment and including the counts for each sample and classifier. The table is generated once for each marker generated. The filtering discards samples with =<20 reads and singletons and the barplots in the reports where generated from the filtered OTU table.\n- `results/<project_name>/classification/{classifier}/{marker}.merged.outmat.tsv`: An OTU table based on the taxonomy assignment and including the counts for each sample. One separate table is generated for each marker investigated and classifier used. \n\n\n### Generate a report with the old report format\n\nSnakemake v7.32.4 generates reports in a new format, which is a bit more convoluted than the older format. If you prefer the old format, you can create if running snakemake --report with an older version, such as snakemake v6.8.0."},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":false,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"run_nanoITS.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","theme":{"light":"sandstone","dark":"darkly"},"code-copy":true,"title":"Run NanoITS"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}